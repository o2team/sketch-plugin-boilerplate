{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./node_modules/@skpm/promise/index.js","webpack://exports/./node_modules/mocha-js-delegate/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/browser-api.js","webpack://exports/./node_modules/sketch-module-web-view/lib/constants.js","webpack://exports/./node_modules/sketch-module-web-view/lib/dispatch-first-click.js","webpack://exports/./node_modules/sketch-module-web-view/lib/execute-javascript.js","webpack://exports/./node_modules/sketch-module-web-view/lib/fitSubview.js","webpack://exports/./node_modules/sketch-module-web-view/lib/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/inject-client-messaging.js","webpack://exports/./node_modules/sketch-module-web-view/lib/movable-area.js","webpack://exports/./node_modules/sketch-module-web-view/lib/parseWebArguments.js","webpack://exports/./node_modules/sketch-module-web-view/lib/set-delegates.js","webpack://exports/./node_modules/sketch-module-web-view/lib/webview-api.js","webpack://exports/./src/sidePanel.js","webpack://exports/./src/state.js","webpack://exports/./src/utils/element.js","webpack://exports/./src/utils/file.js","webpack://exports/./src/utils/index.js","webpack://exports/./src/utils/selector.js","webpack://exports/./src/utils/system.js","webpack://exports/./src/webview/index.js","webpack://exports/external \"events\"","webpack://exports/external \"sketch\""],"names":["insertSidePanel","toolbar","identifier","isInsert","contentView","context","document","documentWindow","stageView","subviews","objectAtIndex","views","existId","find","d","concat","finalViews","pushedWebView","i","count","view","push","setSettingForKey","SidePanelIdentifier","removeSettingForKey","adjustSubviews","onToggleSidePanel","console","error","initState","threadDictionary","NSThread","mainThread","onShutdown","COScript","currentCOScript","setShouldKeepAround","observerWindowResizeNotification","curWebView","BrowserManage","getCurrent","updatePosition","NSStackView","alloc","initWithFrame","NSMakeRect","setSpacing","setFlipped","setBackgroundColor","NSColor","windowBackgroundColor","orientation","addView_inGravity","createImageView","NSMakeSize","Logo","addSubview","Menus","map","item","index","rect","size","icon","activeIcon","tooltip","wkIdentifier","type","inGravityType","url","Button","addButton","callAction","sender","menuBtnRegExp","RegExp","IdentifierPrefix","k","test","setState","NSOffState","options","frame","show","width","height","Browser","browserWindow","webView","webContents","on","createBoxSeparator","length","onOpenDocument","onCloseDocument","empty","prefixRegExp","webViewPrefixRegExp","key","close","removeObjectForKey","removeObserverWindowResizeNotification","version","sketchVersion","pluginFolderPath","resourcesPath","documentObjectID","WINDOW_MOVE_INSTANCE","WINDOW_MOVE_SELECTOR","updateIdentifier","objectID","getPluginFolderPath","split","scriptPath","splice","join","ctx","actionContext","MSDocument","currentDocument","documentData","String","plugin","toString","api","getImageURL","name","isRetinaDisplay","NSScreen","mainScreen","backingScaleFactor","suffix","pluginSketch","imageURL","URLByAppendingPathComponent","createImage","Image","NSImage","initWithContentsOfURL","setSize","setScalesWhenResized","imageView","NSImageView","image","setImage","setAutoresizingMask","separtorBox","NSBox","NSZeroRect","setBoxType","NSBoxSeparator","setBorderColor","colorWithHex","colorWithSRGBRed_green_blue_alpha","button","NSButton","init","activeImageURL","activeImage","setAlternateImage","setBordered","sizeToFit","setToolTip","setButtonType","NSMomentaryChangeButton","setCOSJSTargetFunction","setAction","removeBadge","hasBadge","createBounds","x","y","createPanel","minWidth","minHeight","title","vibrancy","mainScreenRect","screens","firstObject","Bounds","Math","round","NSWidth","NSHeight","panel","NSPanel","setFrame_display","setOpaque","setStyleMask","NSWindowStyleMaskFullSizeContentView","NSBorderlessWindowMask","NSResizableWindowMask","NSTexturedBackgroundWindowMask","NSTitledWindowMask","NSClosableWindowMask","NSFullSizeContentViewWindowMask","NSWindowStyleMaskResizable","whiteColor","movableByWindowBackground","titlebarAppearsTransparent","titleVisibility","NSWindowTitleHidden","center","makeKeyAndOrderFront","setLevel","NSFloatingWindowLevel","minSize","standardWindowButton","NSWindowZoomButton","setHidden","NSWindowMiniaturizeButton","NSWindowCloseButton","setEnabled","NSWindowFullScreenButton","showsToolbarButton","effectView","NSVisualEffectView","setMaterial","NSVisualEffectMaterialPopover","NSViewWidthSizable","NSViewHeightSizable","setAppearance","NSAppearance","appearanceNamed","NSAppearanceNameVibrantLight","setBlendingMode","NSVisualEffectBlendingModeBehindWindow","closeButton","log","createView","NSView","createBox","box","setTitle","createTextField","string","field","NSTextField","setStringValue","setFont","NSFont","systemFontOfSize","setTextColor","colorWithCalibratedRed_green_blue_alpha","setBezeled","setEditable","File","fileManager","NSFileManager","defaultManager","_stringify","jsonData","opt","nsJson","NSJSONSerialization","dataWithJSONObject_options_error_","nil","NSString","initWithData_encoding","writeFile","content","path","stringWithFormat","writeToFile_atomically_encoding_error_","copyFile","dist","fileExistsAtPath","copyItemAtPath_toPath_error","mkDir","createDirectoryAtPath_withIntermediateDirectories_attributes_error_","readJSON","src","NSData","dataWithContentsOfFile","JSONObjectWithData_options_error","patch","attributesOfItemAtPath_error","NSFileSize","e","renameFile","from","to","moveItemAtPath_toPath_error","exist","readDir","contentsOfDirectoryAtPath_error_","removeDir","removeItemAtPath_error","getTempDirPath","URL","URLsForDirectory_inDomains","lastObject","hash","Date","now","nsString","mkTempDir","saveImage","tiffData","TIFFRepresentation","p","NSBitmapImageRep","imageRepWithData","data","representationUsingType_properties","NSPNGFileType","writeToFile_atomically","jsonFilePaths","filename","ds","enumeratorAtPath","paths","nextObject","pathExtension","getSketchSelected","Document","sketch","getSelectedDocument","page","selectedPage","artboard","Artboard","fromNative","_object","currentArtboard","selection","selectedLayers","getSelected","command","currentPage","artboards","selectedArtboard","getScriptExecPath","getDocumentID","getDocumentPath","fileURL","getDocumentName","lastPathComponent","dumpLayer","sketchObject","treeAsDictionary","nsData","initWithData_encoding_","dumpSymbol","symbolInstance","immutableInstance","immutableModelObject","MSJSONDataArchiver","archiveStringWithRootObject_error","penUrlInBrowser","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","getNewUUID","NSUUID","UUID","UUIDString","getThreadDictForKey","setThreadDictForKey","value","removeThreadDictForKey","getSettingForKey","NSUserDefaults","standardUserDefaults","objectForKey","setObject_forKey","showPluginsPane","MSPluginsPreferencePane","preferencesController","MSPreferencesController","sharedController","switchToPaneWithIdentifier","currentPreferencePane","tableView","reloadData","showLibrariesPane","MSAssetLibrariesPreferencePane","getSystemVersion","systemVersion","NSProcessInfo","processInfo","operatingSystemVersionString","match","versions","getPluginVersion","reloadPlugins","AppController","sharedInstance","pluginManager","getFileContentFromModal","fileTypes","openPanel","NSOpenPanel","canCreateDirectories","canChooseFiles","allowedFileTypes","openPanelButtonPressed","runModal","NSModalResponseOK","filePath","stringWithContentsOfFile_encoding_error","NSUTF8StringEncoding","getSavePathFromModal","fileName","savePanel","NSSavePanel","nameFieldStringValue","savePanelActionStatus","fn","Selector","NSSelectorFromString","delegate","MochaJSDelegate","notification","delegateInstance","getClassInstance","NSNotificationCenter","defaultCenter","addObserver_selector_name_object","NSWindowDidResizeNotification","removeObserver_name_object","list","add","browser","get","isVisible","getAbsScreenOfTop","origin","window","convertRectToScreen","getAbsWindowOfView","bounds","convertRect_toView","Object","assign","minimizable","resizable","transparent","closable","alwaysOnTop","titleBarStyle","forEach","hide","existBrowser","BrowserWindow","loadURL","_panel","NSWindowStyleMaskDocModalWindow","addChildWindow_ordered","removeAllListeners","getSize","winRect","senderRect"],"mappings":";;;;;;;;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA,aAAa,SAAS;AACtB;AACA,aAAa,kBAAkB;AAC/B;AACA,aAAa,kBAAkB;AAC/B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC,SAAS;AAC9C;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;AC9QA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc,wDAAwD,EAAE;AACxE;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC;AACvC;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,+BAA+B;AACnE;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,+BAA+B;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oCAAoC,aAAa;AACjD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClmBA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,QAAQ;AACR,gBAAgB;AAChB,MAAM,eAAe;AACrB,0CAA0C,cAAc;AACxD,MAAM;AACN;AACA;;;;;;;;;;;;ACrBA,+DAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,YAAY;AACZ,gCAAgC;AAChC,wFAAwF;AACxF,qCAAqC;AACrC;AACA;AACA,mBAAmB;AACnB,YAAY;AACZ,kCAAkC;AAClC;AACA;AACA,kBAAkB;AAClB,YAAY;AACZ,UAAU,OAAO;AACjB;AACA;AACA,kBAAkB;AAClB,UAAU;AACV,QAAQ,cAAc;AACtB;AACA;AACA,kBAAkB;AAClB,QAAQ;AACR,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrBA;AACA;AACA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,sBAAsB,mBAAO,CAAC,+EAAe;AAC7C,kBAAkB,mBAAO,CAAC,+EAAe;AACzC,uBAAuB,mBAAO,CAAC,6EAAc;AAC7C,yBAAyB,mBAAO,CAAC,iGAAwB;AACzD,4BAA4B,mBAAO,CAAC,uGAA2B;AAC/D,kBAAkB,mBAAO,CAAC,iFAAgB;AAC1C,wBAAwB,mBAAO,CAAC,6FAAsB;AACtD,mBAAmB,mBAAO,CAAC,mFAAiB;;AAE5C;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;AC1VA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,qDAAqD;AACrD,gDAAgD;AAChD,uBAAuB;AACvB;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACxBA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,mBAAmB;AACnB,yDAAyD;AACzD;AACA,kCAAkC;AAClC,2CAA2C,4BAA4B,eAAe;AACtF,gCAAgC,yBAAyB,cAAc;AACvE;AACA,OAAO;AACP;AACA,8BAA8B,eAAe;AAC7C,qDAAqD,SAAS;AAC9D;AACA;AACA,QAAQ;AACR,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;;;;;;;;;;;AC/DA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClBA,gBAAgB,mBAAO,CAAC,oEAAmB;AAC3C,wBAAwB,mBAAO,CAAC,2FAAqB;AACrD,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,2CAA2C;AAC3C,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;;;;;;;;;ACpUA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,wBAAwB,mBAAO,CAAC,6FAAsB;;AAEtD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA,QAAQ,kCAAkC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;ACrOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;;;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","file":"sidePanel.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/sidePanel.js\");\n","/* from https://github.com/taylorhakes/promise-polyfill */\n\nfunction promiseFinally(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nfunction noop() {}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError(\"Promises must be constructed via new\");\n  if (typeof fn !== \"function\") throw new TypeError(\"not a function\");\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError(\"A promise cannot be resolved with itself.\");\n    if (\n      newValue &&\n      (typeof newValue === \"object\" || typeof newValue === \"function\")\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === \"function\") {\n        doResolve(then.bind(newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value, self);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : null;\n  this.onRejected = typeof onRejected === \"function\" ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) {\n          Promise._multipleResolvesFn(\"resolve\", self, value);\n          return;\n        }\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) {\n          Promise._multipleResolvesFn(\"reject\", self, reason);\n          return;\n        }\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) {\n      Promise._multipleResolvesFn(\"reject\", self, ex);\n      return;\n    }\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype[\"catch\"] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype[\"finally\"] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.all accepts an array\"));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === \"object\" || typeof val === \"function\")) {\n          var then = val.then;\n          if (typeof then === \"function\") {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === \"object\" && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.race accepts an array\"));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn = setImmediate;\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err, promise) {\n  if (\n    typeof process !== \"undefined\" &&\n    process.listenerCount &&\n    (process.listenerCount(\"unhandledRejection\") ||\n      process.listenerCount(\"uncaughtException\"))\n  ) {\n    process.emit(\"unhandledRejection\", err, promise);\n    process.emit(\"uncaughtException\", err, \"unhandledRejection\");\n  } else if (typeof console !== \"undefined\" && console) {\n    console.warn(\"Possible Unhandled Promise Rejection:\", err);\n  }\n};\n\nPromise._multipleResolvesFn = function _multipleResolvesFn(\n  type,\n  promise,\n  value\n) {\n  if (typeof process !== \"undefined\" && process.emit) {\n    process.emit(\"multipleResolves\", type, promise, value);\n  }\n};\n\nmodule.exports = Promise;\n","/* globals MOClassDescription, NSObject, NSSelectorFromString, NSClassFromString, MOPropertyDescription */\n\nmodule.exports = function MochaDelegate(definition, superclass) {\n  var uniqueClassName =\n    'MochaJSDelegate_DynamicClass_' + NSUUID.UUID().UUIDString()\n\n  var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(\n    uniqueClassName,\n    superclass || NSObject\n  )\n\n  // Storage\n  var handlers = {}\n  var ivars = {}\n\n  // Define an instance method\n  function setHandlerForSelector(selectorString, func) {\n    var handlerHasBeenSet = selectorString in handlers\n    var selector = NSSelectorFromString(selectorString)\n\n    handlers[selectorString] = func\n\n    /*\n      For some reason, Mocha acts weird about arguments: https://github.com/logancollins/Mocha/issues/28\n      We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n    */\n    if (!handlerHasBeenSet) {\n      var args = []\n      var regex = /:/g\n      while (regex.exec(selectorString)) {\n        args.push('arg' + args.length)\n      }\n\n      // eslint-disable-next-line no-eval\n      var dynamicFunction = eval(\n        '(function (' +\n          args.join(', ') +\n          ') { return handlers[selectorString].apply(this, arguments); })'\n      )\n\n      delegateClassDesc.addInstanceMethodWithSelector_function(\n        selector,\n        dynamicFunction\n      )\n    }\n  }\n\n  // define a property\n  function setIvar(key, value) {\n    var ivarHasBeenSet = key in handlers\n\n    ivars[key] = value\n\n    if (!ivarHasBeenSet) {\n      delegateClassDesc.addInstanceVariableWithName_typeEncoding(key, '@')\n      var description = MOPropertyDescription.new()\n      description.name = key\n      description.typeEncoding = '@'\n      description.weak = true\n      description.ivarName = key\n      delegateClassDesc.addProperty(description)\n    }\n  }\n\n  this.getClass = function() {\n    return NSClassFromString(uniqueClassName)\n  }\n\n  this.getClassInstance = function(instanceVariables) {\n    var instance = NSClassFromString(uniqueClassName).new()\n    Object.keys(ivars).forEach(function(key) {\n      instance[key] = ivars[key]\n    })\n    Object.keys(instanceVariables || {}).forEach(function(key) {\n      instance[key] = instanceVariables[key]\n    })\n    return instance\n  }\n  // alias\n  this.new = this.getClassInstance\n\n  // Convenience\n  if (typeof definition === 'object') {\n    Object.keys(definition).forEach(\n      function(key) {\n        if (typeof definition[key] === 'function') {\n          setHandlerForSelector(key, definition[key])\n        } else {\n          setIvar(key, definition[key])\n        }\n      }\n    )\n  }\n\n  delegateClassDesc.registerClass()\n}\n","function parseHexColor(color) {\n  // Check the string for incorrect formatting.\n  if (!color || color[0] !== '#') {\n    if (\n      color &&\n      typeof color.isKindOfClass === 'function' &&\n      color.isKindOfClass(NSColor)\n    ) {\n      return color\n    }\n    throw new Error(\n      'Incorrect color formating. It should be an hex color: #RRGGBBAA'\n    )\n  }\n\n  // append FF if alpha channel is not specified.\n  var source = color.substr(1)\n  if (source.length === 3) {\n    source += 'F'\n  } else if (source.length === 6) {\n    source += 'FF'\n  }\n  // Convert the string from #FFF format to #FFFFFF format.\n  var hex\n  if (source.length === 4) {\n    for (var i = 0; i < 4; i += 1) {\n      hex += source[i]\n      hex += source[i]\n    }\n  } else if (source.length === 8) {\n    hex = source\n  } else {\n    return NSColor.whiteColor()\n  }\n\n  var r = parseInt(hex.slice(0, 2), 16)\n  var g = parseInt(hex.slice(2, 4), 16)\n  var b = parseInt(hex.slice(4, 6), 16)\n  var a = parseInt(hex.slice(6, 8), 16)\n\n  return NSColor.colorWithSRGBRed_green_blue_alpha(r, g, b, a)\n}\n\nmodule.exports = function(browserWindow, panel, webview) {\n  // keep reference to the subviews\n  browserWindow._panel = panel\n  browserWindow._webview = webview\n  browserWindow._destroyed = false\n\n  browserWindow.destroy = function() {\n    return panel.close()\n  }\n\n  browserWindow.close = function() {\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      var shouldClose = true\n      browserWindow.emit('close', {\n        get defaultPrevented() {\n          return !shouldClose\n        },\n        preventDefault: function() {\n          shouldClose = false\n        },\n      })\n      if (shouldClose) {\n        panel.delegate().utils.parentWindow.endSheet(panel)\n      }\n      return\n    }\n\n    if (!browserWindow.isClosable()) {\n      return\n    }\n\n    panel.performClose(null)\n  }\n\n  function focus(focused) {\n    if (!browserWindow.isVisible()) {\n      return\n    }\n    if (focused) {\n      NSApplication.sharedApplication().activateIgnoringOtherApps(true)\n      panel.makeKeyAndOrderFront(null)\n    } else {\n      panel.orderBack(null)\n      NSApp.mainWindow().makeKeyAndOrderFront(null)\n    }\n  }\n\n  browserWindow.focus = focus.bind(this, true)\n  browserWindow.blur = focus.bind(this, false)\n\n  browserWindow.isFocused = function() {\n    return panel.isKeyWindow()\n  }\n\n  browserWindow.isDestroyed = function() {\n    return browserWindow._destroyed\n  }\n\n  browserWindow.show = function() {\n    // This method is supposed to put focus on window, however if the app does not\n    // have focus then \"makeKeyAndOrderFront\" will only show the window.\n    NSApp.activateIgnoringOtherApps(true)\n\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      return panel.delegate().utils.parentWindow.beginSheet_completionHandler(\n        panel,\n        __mocha__.createBlock_function('v16@?0q8', function() {\n          browserWindow.emit('closed')\n        })\n      )\n    }\n\n    return panel.makeKeyAndOrderFront(null)\n  }\n\n  browserWindow.showInactive = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.hide = function() {\n    return panel.orderOut(null)\n  }\n\n  browserWindow.isVisible = function() {\n    return panel.isVisible()\n  }\n\n  browserWindow.isModal = function() {\n    return false\n  }\n\n  browserWindow.maximize = function() {\n    if (!browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n  browserWindow.unmaximize = function() {\n    if (browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n\n  browserWindow.isMaximized = function() {\n    if ((panel.styleMask() & NSResizableWindowMask) !== 0) {\n      return panel.isZoomed()\n    }\n    var rectScreen = NSScreen.mainScreen().visibleFrame()\n    var rectWindow = panel.frame()\n    return (\n      rectScreen.origin.x == rectWindow.origin.x &&\n      rectScreen.origin.y == rectWindow.origin.y &&\n      rectScreen.size.width == rectWindow.size.width &&\n      rectScreen.size.height == rectWindow.size.height\n    )\n  }\n\n  browserWindow.minimize = function() {\n    return panel.miniaturize(null)\n  }\n\n  browserWindow.restore = function() {\n    return panel.deminiaturize(null)\n  }\n\n  browserWindow.isMinimized = function() {\n    return panel.isMiniaturized()\n  }\n\n  browserWindow.setFullScreen = function(fullscreen) {\n    if (fullscreen !== browserWindow.isFullscreen()) {\n      panel.toggleFullScreen(null)\n    }\n  }\n\n  browserWindow.isFullscreen = function() {\n    return panel.styleMask() & NSFullScreenWindowMask\n  }\n\n  browserWindow.setAspectRatio = function(aspectRatio /* , extraSize */) {\n    // Reset the behaviour to default if aspect_ratio is set to 0 or less.\n    if (aspectRatio > 0.0) {\n      panel.setAspectRatio(NSMakeSize(aspectRatio, 1.0))\n    } else {\n      panel.setResizeIncrements(NSMakeSize(1.0, 1.0))\n    }\n  }\n\n  browserWindow.setBounds = function(bounds, animate) {\n    if (!bounds) {\n      return\n    }\n\n    // Do nothing if in fullscreen mode.\n    if (browserWindow.isFullscreen()) {\n      return\n    }\n\n    const newBounds = Object.assign(browserWindow.getBounds(), bounds)\n\n    // TODO: Check size constraints since setFrame does not check it.\n    // var size = bounds.size\n    // size.SetToMax(GetMinimumSize());\n    // gfx::Size max_size = GetMaximumSize();\n    // if (!max_size.IsEmpty())\n    //   size.SetToMin(max_size);\n\n    var cocoaBounds = NSMakeRect(\n      newBounds.x,\n      0,\n      newBounds.width,\n      newBounds.height\n    )\n    // Flip Y coordinates based on the primary screen\n    var screen = NSScreen.screens().firstObject()\n    cocoaBounds.origin.y = NSHeight(screen.frame()) - newBounds.y\n\n    panel.setFrame_display_animate(cocoaBounds, true, animate)\n  }\n\n  browserWindow.getBounds = function() {\n    const cocoaBounds = panel.frame()\n    var mainScreenRect = NSScreen.screens()\n      .firstObject()\n      .frame()\n    return {\n      x: cocoaBounds.origin.x,\n      y: Math.round(NSHeight(mainScreenRect) - cocoaBounds.origin.y),\n      width: cocoaBounds.size.width,\n      height: cocoaBounds.size.height,\n    }\n  }\n\n  browserWindow.setContentBounds = function(bounds, animate) {\n    // TODO:\n    browserWindow.setBounds(bounds, animate)\n  }\n\n  browserWindow.getContentBounds = function() {\n    // TODO:\n    return browserWindow.getBounds()\n  }\n\n  browserWindow.setSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setBounds({ width: width, height: height }, animate)\n  }\n\n  browserWindow.getSize = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setContentSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setContentBounds(\n      { width: width, height: height },\n      animate\n    )\n  }\n\n  browserWindow.getContentSize = function() {\n    var bounds = browserWindow.getContentBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setMinimumSize = function(width, height) {\n    const minSize = CGSizeMake(width, height)\n    panel.setContentMinSize(minSize)\n  }\n\n  browserWindow.getMinimumSize = function() {\n    const size = panel.contentMinSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setMaximumSize = function(width, height) {\n    const maxSize = CGSizeMake(width, height)\n    panel.setContentMaxSize(maxSize)\n  }\n\n  browserWindow.getMaximumSize = function() {\n    const size = panel.contentMaxSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setResizable = function(resizable) {\n    return browserWindow._setStyleMask(resizable, NSResizableWindowMask)\n  }\n\n  browserWindow.isResizable = function() {\n    return panel.styleMask() & NSResizableWindowMask\n  }\n\n  browserWindow.setMovable = function(movable) {\n    return panel.setMovable(movable)\n  }\n  browserWindow.isMovable = function() {\n    return panel.isMovable()\n  }\n\n  browserWindow.setMinimizable = function(minimizable) {\n    return browserWindow._setStyleMask(minimizable, NSMiniaturizableWindowMask)\n  }\n\n  browserWindow.isMinimizable = function() {\n    return panel.styleMask() & NSMiniaturizableWindowMask\n  }\n\n  browserWindow.setMaximizable = function(maximizable) {\n    if (panel.standardWindowButton(NSWindowZoomButton)) {\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(maximizable)\n    }\n  }\n\n  browserWindow.isMaximizable = function() {\n    return (\n      panel.standardWindowButton(NSWindowZoomButton) &&\n      panel.standardWindowButton(NSWindowZoomButton).isEnabled()\n    )\n  }\n\n  browserWindow.setFullScreenable = function(fullscreenable) {\n    browserWindow._setCollectionBehavior(\n      fullscreenable,\n      NSWindowCollectionBehaviorFullScreenPrimary\n    )\n    // On EL Capitan this flag is required to hide fullscreen button.\n    browserWindow._setCollectionBehavior(\n      !fullscreenable,\n      NSWindowCollectionBehaviorFullScreenAuxiliary\n    )\n  }\n\n  browserWindow.isFullScreenable = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorFullScreenPrimary\n  }\n\n  browserWindow.setClosable = function(closable) {\n    browserWindow._setStyleMask(closable, NSClosableWindowMask)\n  }\n\n  browserWindow.isClosable = function() {\n    return panel.styleMask() & NSClosableWindowMask\n  }\n\n  browserWindow.setAlwaysOnTop = function(top, level, relativeLevel) {\n    var windowLevel = NSNormalWindowLevel\n    var maxWindowLevel = CGWindowLevelForKey(kCGMaximumWindowLevelKey)\n    var minWindowLevel = CGWindowLevelForKey(kCGMinimumWindowLevelKey)\n\n    if (top) {\n      if (level === 'normal') {\n        windowLevel = NSNormalWindowLevel\n      } else if (level === 'torn-off-menu') {\n        windowLevel = NSTornOffMenuWindowLevel\n      } else if (level === 'modal-panel') {\n        windowLevel = NSModalPanelWindowLevel\n      } else if (level === 'main-menu') {\n        windowLevel = NSMainMenuWindowLevel\n      } else if (level === 'status') {\n        windowLevel = NSStatusWindowLevel\n      } else if (level === 'pop-up-menu') {\n        windowLevel = NSPopUpMenuWindowLevel\n      } else if (level === 'screen-saver') {\n        windowLevel = NSScreenSaverWindowLevel\n      } else if (level === 'dock') {\n        // Deprecated by macOS, but kept for backwards compatibility\n        windowLevel = NSDockWindowLevel\n      } else {\n        windowLevel = NSFloatingWindowLevel\n      }\n    }\n\n    var newLevel = windowLevel + (relativeLevel || 0)\n    if (newLevel >= minWindowLevel && newLevel <= maxWindowLevel) {\n      panel.setLevel(newLevel)\n    } else {\n      throw new Error(\n        'relativeLevel must be between ' +\n          minWindowLevel +\n          ' and ' +\n          maxWindowLevel\n      )\n    }\n  }\n\n  browserWindow.isAlwaysOnTop = function() {\n    return panel.level() !== NSNormalWindowLevel\n  }\n\n  browserWindow.moveTop = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.center = function() {\n    panel.center()\n  }\n\n  browserWindow.setPosition = function(x, y, animate) {\n    return browserWindow.setBounds({ x: x, y: y }, animate)\n  }\n\n  browserWindow.getPosition = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.x, bounds.y]\n  }\n\n  browserWindow.setTitle = function(title) {\n    panel.setTitle(title)\n  }\n\n  browserWindow.getTitle = function() {\n    return String(panel.title())\n  }\n\n  var attentionRequestId = 0\n  browserWindow.flashFrame = function(flash) {\n    if (flash) {\n      attentionRequestId = NSApp.requestUserAttention(NSInformationalRequest)\n    } else {\n      NSApp.cancelUserAttentionRequest(attentionRequestId)\n      attentionRequestId = 0\n    }\n  }\n\n  browserWindow.getNativeWindowHandle = function() {\n    return panel\n  }\n\n  browserWindow.getNativeWebViewHandle = function() {\n    return webview\n  }\n\n  browserWindow.loadURL = function(url) {\n    // When frameLocation is a file, prefix it with the Sketch Resources path\n    if (/^(?!https?|file).*\\.html?$/.test(url)) {\n      if (typeof __command !== 'undefined' && __command.pluginBundle()) {\n        url =\n          'file://' +\n          __command\n            .pluginBundle()\n            .urlForResourceNamed(url)\n            .path()\n      }\n    }\n\n    if (/^file:\\/\\/.*\\.html?$/.test(url)) {\n      // ensure URLs containing spaces are properly handled\n      url = NSString.alloc().initWithString(url)\n      url = url.stringByAddingPercentEncodingWithAllowedCharacters(\n        NSCharacterSet.URLQueryAllowedCharacterSet()\n      )\n      webview.loadFileURL_allowingReadAccessToURL(\n        NSURL.URLWithString(url),\n        NSURL.URLWithString('file:///')\n      )\n      return\n    }\n\n    const properURL = NSURL.URLWithString(url)\n    const urlRequest = NSURLRequest.requestWithURL(properURL)\n\n    webview.loadRequest(urlRequest)\n  }\n\n  browserWindow.reload = function() {\n    webview.reload()\n  }\n\n  browserWindow.setHasShadow = function(hasShadow) {\n    return panel.setHasShadow(hasShadow)\n  }\n\n  browserWindow.hasShadow = function() {\n    return panel.hasShadow()\n  }\n\n  browserWindow.setOpacity = function(opacity) {\n    return panel.setAlphaValue(opacity)\n  }\n\n  browserWindow.getOpacity = function() {\n    return panel.alphaValue()\n  }\n\n  browserWindow.setVisibleOnAllWorkspaces = function(visible) {\n    return browserWindow._setCollectionBehavior(\n      visible,\n      NSWindowCollectionBehaviorCanJoinAllSpaces\n    )\n  }\n\n  browserWindow.isVisibleOnAllWorkspaces = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorCanJoinAllSpaces\n  }\n\n  browserWindow.setIgnoreMouseEvents = function(ignore) {\n    return panel.setIgnoresMouseEvents(ignore)\n  }\n\n  browserWindow.setContentProtection = function(enable) {\n    panel.setSharingType(enable ? NSWindowSharingNone : NSWindowSharingReadOnly)\n  }\n\n  browserWindow.setAutoHideCursor = function(autoHide) {\n    panel.setDisableAutoHideCursor(autoHide)\n  }\n\n  browserWindow.setVibrancy = function(type) {\n    var effectView = browserWindow._vibrantView\n\n    if (!type) {\n      if (effectView == null) {\n        return\n      }\n\n      effectView.removeFromSuperview()\n      panel.setVibrantView(null)\n      return\n    }\n\n    if (effectView == null) {\n      var contentView = panel.contentView()\n      effectView = NSVisualEffectView.alloc().initWithFrame(\n        contentView.bounds()\n      )\n      browserWindow._vibrantView = effectView\n\n      effectView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n      effectView.setBlendingMode(NSVisualEffectBlendingModeBehindWindow)\n      effectView.setState(NSVisualEffectStateActive)\n      effectView.setFrame(contentView.bounds())\n      contentView.addSubview_positioned_relativeTo(\n        effectView,\n        NSWindowBelow,\n        null\n      )\n    }\n\n    var vibrancyType = NSVisualEffectMaterialLight\n\n    if (type === 'appearance-based') {\n      vibrancyType = NSVisualEffectMaterialAppearanceBased\n    } else if (type === 'light') {\n      vibrancyType = NSVisualEffectMaterialLight\n    } else if (type === 'dark') {\n      vibrancyType = NSVisualEffectMaterialDark\n    } else if (type === 'titlebar') {\n      vibrancyType = NSVisualEffectMaterialTitlebar\n    } else if (type === 'selection') {\n      vibrancyType = NSVisualEffectMaterialSelection\n    } else if (type === 'menu') {\n      vibrancyType = NSVisualEffectMaterialMenu\n    } else if (type === 'popover') {\n      vibrancyType = NSVisualEffectMaterialPopover\n    } else if (type === 'sidebar') {\n      vibrancyType = NSVisualEffectMaterialSidebar\n    } else if (type === 'medium-light') {\n      vibrancyType = NSVisualEffectMaterialMediumLight\n    } else if (type === 'ultra-dark') {\n      vibrancyType = NSVisualEffectMaterialUltraDark\n    }\n\n    effectView.setMaterial(vibrancyType)\n  }\n\n  browserWindow._setBackgroundColor = function(colorName) {\n    var color = parseHexColor(colorName)\n    webview.setValue_forKey(false, 'drawsBackground')\n    panel.backgroundColor = color\n  }\n\n  browserWindow._invalidate = function() {\n    panel.flushWindow()\n    panel.contentView().setNeedsDisplay(true)\n  }\n\n  browserWindow._setStyleMask = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setStyleMask(panel.styleMask() | flag)\n    } else {\n      panel.setStyleMask(panel.styleMask() & ~flag)\n    }\n    // Change style mask will make the zoom button revert to default, probably\n    // a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._setCollectionBehavior = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setCollectionBehavior(panel.collectionBehavior() | flag)\n    } else {\n      panel.setCollectionBehavior(panel.collectionBehavior() & ~flag)\n    }\n    // Change collectionBehavior will make the zoom button revert to default,\n    // probably a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._showWindowButton = function(button) {\n    var view = panel.standardWindowButton(button)\n    view.superview().addSubview_positioned_relative(view, NSWindowAbove, null)\n  }\n}\n","module.exports = {\n  JS_BRIDGE: '__skpm_sketchBridge',\n  START_MOVING_WINDOW: '__skpm_startMovingWindow',\n  EXECUTE_JAVASCRIPT: '__skpm_executeJS',\n  EXECUTE_JAVASCRIPT_SUCCESS: '__skpm_executeJS_success_',\n  EXECUTE_JAVASCRIPT_ERROR: '__skpm_executeJS_error_',\n}\n","var tagsToFocus =\n  '[\"text\", \"textarea\", \"date\", \"datetime-local\", \"email\", \"number\", \"month\", \"password\", \"search\", \"tel\", \"time\", \"url\", \"week\" ]'\n\nmodule.exports = function(webView, event) {\n  var point = webView.convertPoint_fromView(event.locationInWindow(), null)\n  return (\n    'var el = document.elementFromPoint(' + // get the DOM element that match the event\n    point.x +\n    ', ' +\n    point.y +\n    '); ' +\n    'if (el && ' + // some tags need to be focused instead of clicked\n    tagsToFocus +\n    '.indexOf(el.type) >= 0 && ' +\n    'el.focus' +\n    ') {' +\n    'el.focus();' + // so focus them\n    '} else if (el) {' +\n    'el.dispatchEvent(new Event(\"click\", {bubbles: true}))' + // click the others\n    '}'\n  )\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webview, browserWindow) {\n  function executeJavaScript(script, userGesture, callback) {\n    if (typeof userGesture === 'function') {\n      callback = userGesture\n      userGesture = false\n    }\n    var fiber = coscript.createFiber()\n\n    // if the webview is not ready yet, defer the execution until it is\n    if (\n      webview.navigationDelegate().state &&\n      webview.navigationDelegate().state.wasReady == 0\n    ) {\n      return new Promise(function(resolve, reject) {\n        browserWindow.once('ready-to-show', function() {\n          executeJavaScript(script, userGesture, callback)\n            .then(resolve)\n            .catch(reject)\n          fiber.cleanup()\n        })\n      })\n    }\n\n    return new Promise(function(resolve, reject) {\n      var requestId = Math.random()\n\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS + requestId,\n        function(res) {\n          try {\n            if (callback) {\n              callback(null, res)\n            }\n            resolve(res)\n          } catch (err) {\n            reject(err)\n          }\n          fiber.cleanup()\n        }\n      )\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_ERROR + requestId,\n        function(err) {\n          try {\n            if (callback) {\n              callback(err)\n              resolve()\n            } else {\n              reject(err)\n            }\n          } catch (err2) {\n            reject(err2)\n          }\n          fiber.cleanup()\n        }\n      )\n\n      webview.evaluateJavaScript_completionHandler(\n        module.exports.wrapScript(script, requestId),\n        null\n      )\n    })\n  }\n\n  return executeJavaScript\n}\n\nmodule.exports.wrapScript = function(script, requestId) {\n  return (\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    '(' +\n    requestId +\n    ', ' +\n    JSON.stringify(script) +\n    ')'\n  )\n}\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    ' = function(id, script) {' +\n    '  try {' +\n    '    var res = eval(script);' +\n    '    if (res && typeof res.then === \"function\" && typeof res.catch === \"function\") {' +\n    '      res.then(function (res2) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res2);' +\n    '      })' +\n    '      .catch(function (err) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '      })' +\n    '    } else {' +\n    '      window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res);' +\n    '    }' +\n    '  } catch (err) {' +\n    '    window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '  }' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","function addEdgeConstraint(edge, subview, view, constant) {\n  view.addConstraint(\n    NSLayoutConstraint.constraintWithItem_attribute_relatedBy_toItem_attribute_multiplier_constant(\n      subview,\n      edge,\n      NSLayoutRelationEqual,\n      view,\n      edge,\n      1,\n      constant\n    )\n  )\n}\nmodule.exports = function fitSubviewToView(subview, view, constants) {\n  constants = constants || []\n  subview.setTranslatesAutoresizingMaskIntoConstraints(false)\n\n  addEdgeConstraint(NSLayoutAttributeLeft, subview, view, constants[0] || 0)\n  addEdgeConstraint(NSLayoutAttributeTop, subview, view, constants[1] || 0)\n  addEdgeConstraint(NSLayoutAttributeRight, subview, view, constants[2] || 0)\n  addEdgeConstraint(NSLayoutAttributeBottom, subview, view, constants[3] || 0)\n}\n","/* let's try to match the API from Electron's Browser window\n(https://github.com/electron/electron/blob/master/docs/api/browser-window.md) */\nvar EventEmitter = require('events')\nvar buildBrowserAPI = require('./browser-api')\nvar buildWebAPI = require('./webview-api')\nvar fitSubviewToView = require('./fitSubview')\nvar dispatchFirstClick = require('./dispatch-first-click')\nvar injectClientMessaging = require('./inject-client-messaging')\nvar movableArea = require('./movable-area')\nvar executeJavaScript = require('./execute-javascript')\nvar setDelegates = require('./set-delegates')\n\nfunction BrowserWindow(options) {\n  options = options || {}\n\n  var identifier = options.identifier || NSUUID.UUID().UUIDString()\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  var existingBrowserWindow = BrowserWindow.fromId(identifier)\n\n  // if we already have a window opened, reuse it\n  if (existingBrowserWindow) {\n    return existingBrowserWindow\n  }\n\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (options.modal && !options.parent) {\n    throw new Error('A modal needs to have a parent.')\n  }\n\n  // Long-running script\n  var fiber = coscript.createFiber()\n\n  // Window size\n  var width = options.width || 800\n  var height = options.height || 600\n  var mainScreenRect = NSScreen.screens()\n    .firstObject()\n    .frame()\n  var cocoaBounds = NSMakeRect(\n    typeof options.x !== 'undefined'\n      ? options.x\n      : Math.round((NSWidth(mainScreenRect) - width) / 2),\n    typeof options.y !== 'undefined'\n      ? NSHeight(mainScreenRect) - options.y\n      : Math.round((NSHeight(mainScreenRect) - height) / 2),\n    width,\n    height\n  )\n\n  if (options.titleBarStyle && options.titleBarStyle !== 'default') {\n    options.frame = false\n  }\n\n  var useStandardWindow = options.windowType !== 'textured'\n  var styleMask = NSTitledWindowMask\n\n  // this is commented out because the toolbar doesn't appear otherwise :thinking-face:\n  // if (!useStandardWindow || options.frame === false) {\n  //   styleMask = NSFullSizeContentViewWindowMask\n  // }\n  if (options.minimizable !== false) {\n    styleMask |= NSMiniaturizableWindowMask\n  }\n  if (options.closable !== false) {\n    styleMask |= NSClosableWindowMask\n  }\n  if (options.resizable !== false) {\n    styleMask |= NSResizableWindowMask\n  }\n  if (!useStandardWindow || options.transparent || options.frame === false) {\n    styleMask |= NSTexturedBackgroundWindowMask\n  }\n\n  var panel = NSPanel.alloc().initWithContentRect_styleMask_backing_defer(\n    cocoaBounds,\n    styleMask,\n    NSBackingStoreBuffered,\n    true\n  )\n\n  var wkwebviewConfig = WKWebViewConfiguration.alloc().init()\n  var webView = WKWebView.alloc().initWithFrame_configuration(\n    CGRectMake(0, 0, options.width || 800, options.height || 600),\n    wkwebviewConfig\n  )\n  injectClientMessaging(webView)\n  webView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n  setDelegates(browserWindow, panel, webView, options)\n\n  if (options.windowType === 'desktop') {\n    panel.setLevel(kCGDesktopWindowLevel - 1)\n    // panel.setCanBecomeKeyWindow(false)\n    panel.setCollectionBehavior(\n      NSWindowCollectionBehaviorCanJoinAllSpaces |\n        NSWindowCollectionBehaviorStationary |\n        NSWindowCollectionBehaviorIgnoresCycle\n    )\n  }\n\n  if (\n    typeof options.minWidth !== 'undefined' ||\n    typeof options.minHeight !== 'undefined'\n  ) {\n    browserWindow.setMinimumSize(options.minWidth || 0, options.minHeight || 0)\n  }\n\n  if (\n    typeof options.maxWidth !== 'undefined' ||\n    typeof options.maxHeight !== 'undefined'\n  ) {\n    browserWindow.setMaximumSize(\n      options.maxWidth || 10000,\n      options.maxHeight || 10000\n    )\n  }\n\n  // if (options.focusable === false) {\n  //   panel.setCanBecomeKeyWindow(false)\n  // }\n\n  if (options.transparent || options.frame === false) {\n    panel.titlebarAppearsTransparent = true\n    panel.titleVisibility = NSWindowTitleHidden\n    panel.setOpaque(0)\n    panel.isMovableByWindowBackground = true\n    var toolbar2 = NSToolbar.alloc().initWithIdentifier(\n      'titlebarStylingToolbar'\n    )\n    toolbar2.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar2)\n  }\n\n  if (options.titleBarStyle === 'hiddenInset') {\n    var toolbar = NSToolbar.alloc().initWithIdentifier('titlebarStylingToolbar')\n    toolbar.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar)\n  }\n\n  if (options.frame === false || !options.useContentSize) {\n    browserWindow.setSize(width, height)\n  }\n\n  if (options.center) {\n    browserWindow.center()\n  }\n\n  if (options.alwaysOnTop) {\n    browserWindow.setAlwaysOnTop(true)\n  }\n\n  if (options.fullscreen) {\n    browserWindow.setFullScreen(true)\n  }\n  browserWindow.setFullScreenable(!!options.fullscreenable)\n\n  const title =\n    options.title ||\n    (typeof __command !== 'undefined' && __command.pluginBundle()\n      ? __command.pluginBundle().name()\n      : undefined)\n  if (title) {\n    browserWindow.setTitle(title)\n  }\n\n  var backgroundColor = options.backgroundColor\n  if (options.transparent) {\n    backgroundColor = NSColor.clearColor()\n  }\n  if (!backgroundColor && options.frame === false && options.vibrancy) {\n    backgroundColor = NSColor.clearColor()\n  }\n\n  browserWindow._setBackgroundColor(\n    backgroundColor || NSColor.windowBackgroundColor()\n  )\n\n  if (options.hasShadow === false) {\n    browserWindow.setHasShadow(false)\n  }\n\n  if (typeof options.opacity !== 'undefined') {\n    browserWindow.setOpacity(options.opacity)\n  }\n\n  options.webPreferences = options.webPreferences || {}\n\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.devTools !== false,\n      'developerExtrasEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.javascript !== false,\n      'javaScriptEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(!!options.webPreferences.plugins, 'plugInsEnabled')\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.minimumFontSize || 0,\n      'minimumFontSize'\n    )\n\n  if (options.webPreferences.zoomFactor) {\n    webView.setMagnification(options.webPreferences.zoomFactor)\n  }\n\n  var contentView = panel.contentView()\n\n  if (options.frame !== false) {\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n  } else {\n    // In OSX 10.10, adding subviews to the root view for the NSView hierarchy\n    // produces warnings. To eliminate the warnings, we resize the contentView\n    // to fill the window, and add subviews to that.\n    // http://crbug.com/380412\n    contentView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n    fitSubviewToView(contentView, contentView.superview())\n\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n\n    // The fullscreen button should always be hidden for frameless window.\n    if (panel.standardWindowButton(NSWindowFullScreenButton)) {\n      panel.standardWindowButton(NSWindowFullScreenButton).setHidden(true)\n    }\n\n    if (!options.titleBarStyle || options.titleBarStyle === 'default') {\n      // Hide the window buttons.\n      panel.standardWindowButton(NSWindowZoomButton).setHidden(true)\n      panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true)\n      panel.standardWindowButton(NSWindowCloseButton).setHidden(true)\n\n      // Some third-party macOS utilities check the zoom button's enabled state to\n      // determine whether to show custom UI on hover, so we disable it here to\n      // prevent them from doing so in a frameless app window.\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(false)\n    }\n  }\n\n  if (options.vibrancy) {\n    browserWindow.setVibrancy(options.vibrancy)\n  }\n\n  // Set maximizable state last to ensure zoom button does not get reset\n  // by calls to other APIs.\n  browserWindow.setMaximizable(options.maximizable !== false)\n\n  panel.setHidesOnDeactivate(options.hidesOnDeactivate !== false)\n\n  if (options.remembersWindowFrame) {\n    panel.setFrameAutosaveName(identifier)\n    panel.setFrameUsingName_force(panel.frameAutosaveName(), false)\n  }\n\n  if (options.acceptsFirstMouse) {\n    browserWindow.on('focus', function(event) {\n      if (event.type() === NSEventTypeLeftMouseDown) {\n        browserWindow.webContents\n          .executeJavaScript(dispatchFirstClick(webView, event))\n          .catch(() => {})\n      }\n    })\n  }\n\n  executeJavaScript.injectScript(webView)\n  movableArea.injectScript(webView)\n  movableArea.setupHandler(browserWindow)\n\n  if (options.show !== false) {\n    browserWindow.show()\n  }\n\n  browserWindow.on('closed', function() {\n    browserWindow._destroyed = true\n    threadDictionary.removeObjectForKey(identifier)\n    fiber.cleanup()\n  })\n\n  threadDictionary[identifier] = panel\n\n  fiber.onCleanup(function() {\n    if (!browserWindow._destroyed) {\n      browserWindow.destroy()\n    }\n  })\n\n  return browserWindow\n}\n\nBrowserWindow.fromId = function(identifier) {\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  if (threadDictionary[identifier]) {\n    return BrowserWindow.fromPanel(threadDictionary[identifier], identifier)\n  }\n\n  return undefined\n}\n\nBrowserWindow.fromPanel = function(panel, identifier) {\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (!panel || !panel.contentView) {\n    throw new Error('needs to pass an NSPanel')\n  }\n\n  var webView = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webView &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webView = subviews[i]\n    }\n  }\n\n  if (!webView) {\n    throw new Error('The panel needs to have a webview')\n  }\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n\n  return browserWindow\n}\n\nmodule.exports = BrowserWindow\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webView) {\n  var source =\n    'window.originalPostMessage = window.postMessage;' +\n    'window.postMessage = function(actionName) {' +\n    'if (!actionName) {' +\n    \"throw new Error('missing action name')\" +\n    '}' +\n    'window.webkit.messageHandlers.' +\n    CONSTANTS.JS_BRIDGE +\n    '.postMessage(' +\n    'JSON.stringify([].slice.call(arguments))' +\n    ');' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    '(function () {' +\n    \"document.addEventListener('mousedown', onMouseDown);\" +\n    '' +\n    'function shouldDrag(target) {' +\n    '  if (!target || (target.dataset || {}).appRegion === \"no-drag\") { return false }' +\n    '  if ((target.dataset || {}).appRegion === \"drag\") { return true }' +\n    '  return shouldDrag(target.parentElement)' +\n    '};' +\n    '' +\n    'function onMouseDown(e) {console.log(e);' +\n    '  if (e.button !== 0 || !shouldDrag(e.target)) { return }' +\n    '  window.postMessage(\"' +\n    CONSTANTS.START_MOVING_WINDOW +\n    '\");' +\n    '};' +\n    '})()'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n\nmodule.exports.setupHandler = function(browserWindow) {\n  var initialMouseLocation = null\n  var initialWindowPosition = null\n  var interval = null\n\n  function moveWindow() {\n    // if the user released the button, stop moving the window\n    if (!initialWindowPosition || NSEvent.pressedMouseButtons() !== 1) {\n      clearInterval(interval)\n      initialMouseLocation = null\n      initialWindowPosition = null\n      return\n    }\n\n    var mouse = NSEvent.mouseLocation()\n    browserWindow.setPosition(\n      initialWindowPosition.x + (mouse.x - initialMouseLocation.x),\n      initialWindowPosition.y + (initialMouseLocation.y - mouse.y), // y is inverted\n      false\n    )\n  }\n\n  browserWindow.webContents.on(CONSTANTS.START_MOVING_WINDOW, function() {\n    initialMouseLocation = NSEvent.mouseLocation()\n    var position = browserWindow.getPosition()\n    initialWindowPosition = {\n      x: position[0],\n      y: position[1],\n    }\n\n    interval = setInterval(moveWindow, 1000 / 60) // 60 fps\n  })\n}\n","module.exports = function(webArguments) {\n  var args = null\n  try {\n    args = JSON.parse(webArguments)\n  } catch (e) {\n    // malformed arguments\n  }\n\n  if (\n    !args ||\n    !args.constructor ||\n    args.constructor !== Array ||\n    args.length == 0\n  ) {\n    return null\n  }\n\n  return args\n}\n","var ObjCClass = require('mocha-js-delegate')\nvar parseWebArguments = require('./parseWebArguments')\nvar CONSTANTS = require('./constants')\n\n// We create one ObjC class for ourselves here\nvar WindowDelegateClass\nvar NavigationDelegateClass\nvar WebScriptHandlerClass\n\n// TODO: events\n// - 'page-favicon-updated'\n// - 'new-window'\n// - 'did-navigate-in-page'\n// - 'will-prevent-unload'\n// - 'crashed'\n// - 'unresponsive'\n// - 'responsive'\n// - 'destroyed'\n// - 'before-input-event'\n// - 'certificate-error'\n// - 'found-in-page'\n// - 'media-started-playing'\n// - 'media-paused'\n// - 'did-change-theme-color'\n// - 'update-target-url'\n// - 'cursor-changed'\n// - 'context-menu'\n// - 'select-bluetooth-device'\n// - 'paint'\n// - 'console-message'\n\nmodule.exports = function(browserWindow, panel, webview, options) {\n  if (!WindowDelegateClass) {\n    WindowDelegateClass = new ObjCClass({\n      utils: null,\n      panel: null,\n\n      'windowDidResize:': function() {\n        this.utils.emit('resize')\n      },\n\n      'windowDidMiniaturize:': function() {\n        this.utils.emit('minimize')\n      },\n\n      'windowDidDeminiaturize:': function() {\n        this.utils.emit('restore')\n      },\n\n      'windowDidEnterFullScreen:': function() {\n        this.utils.emit('enter-full-screen')\n      },\n\n      'windowDidExitFullScreen:': function() {\n        this.utils.emit('leave-full-screen')\n      },\n\n      'windowDidMove:': function() {\n        this.utils.emit('move')\n        this.utils.emit('moved')\n      },\n\n      'windowShouldClose:': function() {\n        var shouldClose = 1\n        this.utils.emit('close', {\n          get defaultPrevented() {\n            return !shouldClose\n          },\n          preventDefault: function() {\n            shouldClose = 0\n          },\n        })\n        return shouldClose\n      },\n\n      'windowWillClose:': function() {\n        this.utils.emit('closed')\n      },\n\n      'windowDidBecomeKey:': function() {\n        this.utils.emit('focus', this.panel.currentEvent())\n      },\n\n      'windowDidResignKey:': function() {\n        this.utils.emit('blur')\n      },\n    })\n  }\n\n  if (!NavigationDelegateClass) {\n    NavigationDelegateClass = new ObjCClass({\n      state: {\n        wasReady: 0,\n      },\n      utils: null,\n\n      // // Called when the web view begins to receive web content.\n      'webView:didCommitNavigation:': function(webView) {\n        this.utils.emit('will-navigate', {}, String(String(webView.URL())))\n      },\n\n      // // Called when web content begins to load in a web view.\n      'webView:didStartProvisionalNavigation:': function() {\n        this.utils.emit('did-start-navigation')\n        this.utils.emit('did-start-loading')\n      },\n\n      // Called when a web view receives a server redirect.\n      'webView:didReceiveServerRedirectForProvisionalNavigation:': function() {\n        this.utils.emit('did-get-redirect-request')\n      },\n\n      // // Called when the web view needs to respond to an authentication challenge.\n      // 'webView:didReceiveAuthenticationChallenge:completionHandler:': function(\n      //   webView,\n      //   challenge,\n      //   completionHandler\n      // ) {\n      //   function callback(username, password) {\n      //     completionHandler(\n      //       0,\n      //       NSURLCredential.credentialWithUser_password_persistence(\n      //         username,\n      //         password,\n      //         1\n      //       )\n      //     )\n      //   }\n      //   var protectionSpace = challenge.protectionSpace()\n      //   this.utils.emit(\n      //     'login',\n      //     {},\n      //     {\n      //       method: String(protectionSpace.authenticationMethod()),\n      //       url: 'not implemented', // TODO:\n      //       referrer: 'not implemented', // TODO:\n      //     },\n      //     {\n      //       isProxy: !!protectionSpace.isProxy(),\n      //       scheme: String(protectionSpace.protocol()),\n      //       host: String(protectionSpace.host()),\n      //       port: Number(protectionSpace.port()),\n      //       realm: String(protectionSpace.realm()),\n      //     },\n      //     callback\n      //   )\n      // },\n\n      // Called when an error occurs during navigation.\n      // 'webView:didFailNavigation:withError:': function(\n      //   webView,\n      //   navigation,\n      //   error\n      // ) {},\n\n      // Called when an error occurs while the web view is loading content.\n      'webView:didFailProvisionalNavigation:withError:': function(\n        webView,\n        navigation,\n        error\n      ) {\n        this.utils.emit('did-fail-load', error)\n      },\n\n      // Called when the navigation is complete.\n      'webView:didFinishNavigation:': function() {\n        if (this.state.wasReady == 0) {\n          this.state.wasReady = 1\n          this.utils.emitBrowserEvent('ready-to-show')\n        }\n        this.utils.emit('did-navigate')\n        this.utils.emit('did-frame-navigate')\n        this.utils.emit('did-stop-loading')\n        this.utils.emit('did-finish-load')\n        this.utils.emit('did-frame-finish-load')\n      },\n\n      // Called when the web views web content process is terminated.\n      'webViewWebContentProcessDidTerminate:': function() {\n        this.utils.emit('dom-ready')\n      },\n\n      // Decides whether to allow or cancel a navigation.\n      // webView:decidePolicyForNavigationAction:decisionHandler:\n\n      // Decides whether to allow or cancel a navigation after its response is known.\n      // webView:decidePolicyForNavigationResponse:decisionHandler:\n    })\n  }\n\n  if (!WebScriptHandlerClass) {\n    WebScriptHandlerClass = new ObjCClass({\n      utils: null,\n      'userContentController:didReceiveScriptMessage:': function(_, message) {\n        var args = this.utils.parseWebArguments(String(message.body()))\n        if (!args) {\n          return\n        }\n        if (!args[0] || typeof args[0] !== 'string') {\n          return\n        }\n        args[0] = String(args[0])\n\n        this.utils.emit.apply(this, args)\n      },\n    })\n  }\n\n  var navigationDelegate = NavigationDelegateClass.new({\n    utils: {\n      setTitle: browserWindow.setTitle.bind(browserWindow),\n      emitBrowserEvent() {\n        try {\n          browserWindow.emit.apply(browserWindow, arguments)\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n      emit() {\n        try {\n          browserWindow.webContents.emit.apply(\n            browserWindow.webContents,\n            arguments\n          )\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n    },\n    state: {\n      wasReady: 0,\n    },\n  })\n\n  webview.setNavigationDelegate(navigationDelegate)\n\n  var webScriptHandler = WebScriptHandlerClass.new({\n    utils: {\n      emit() {\n        try {\n          browserWindow.webContents.emit.apply(\n            browserWindow.webContents,\n            arguments\n          )\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n      parseWebArguments: parseWebArguments,\n    },\n  })\n\n  webview\n    .configuration()\n    .userContentController()\n    .addScriptMessageHandler_name(webScriptHandler, CONSTANTS.JS_BRIDGE)\n\n  var utils = {\n    emit() {\n      try {\n        browserWindow.emit.apply(browserWindow, arguments)\n      } catch (err) {\n        if (\n          typeof process !== 'undefined' &&\n          process.listenerCount &&\n          process.listenerCount('uncaughtException')\n        ) {\n          process.emit('uncaughtException', err, 'uncaughtException')\n        } else {\n          console.error(err)\n          throw err\n        }\n      }\n    },\n  }\n  if (options.modal) {\n    // find the window of the document\n    var msdocument\n    if (options.parent.type === 'Document') {\n      msdocument = options.parent.sketchObject\n    } else {\n      msdocument = options.parent\n    }\n    if (msdocument && String(msdocument.class()) === 'MSDocumentData') {\n      // we only have an MSDocumentData instead of a MSDocument\n      // let's try to get back to the MSDocument\n      msdocument = msdocument.delegate()\n    }\n    utils.parentWindow = msdocument.windowForSheet()\n  }\n\n  var windowDelegate = WindowDelegateClass.new({\n    utils: utils,\n    panel: panel,\n  })\n\n  panel.setDelegate(windowDelegate)\n}\n","var EventEmitter = require('events')\nvar executeJavaScript = require('./execute-javascript')\n\n// let's try to match https://github.com/electron/electron/blob/master/docs/api/web-contents.md\nmodule.exports = function buildAPI(browserWindow, panel, webview) {\n  var webContents = new EventEmitter()\n\n  webContents.loadURL = browserWindow.loadURL\n\n  webContents.loadFile = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.downloadURL = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.getURL = function() {\n    return String(webview.url())\n  }\n\n  webContents.getTitle = function() {\n    return String(webview.title())\n  }\n\n  webContents.isDestroyed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.focus = browserWindow.focus\n  webContents.isFocused = browserWindow.isFocused\n\n  webContents.isLoading = function() {\n    return !!webview.loading()\n  }\n\n  webContents.isLoadingMainFrame = function() {\n    // TODO:\n    return !!webview.loading()\n  }\n\n  webContents.isWaitingForResponse = function() {\n    return !webview.loading()\n  }\n\n  webContents.stop = function() {\n    webview.stopLoading()\n  }\n  webContents.reload = function() {\n    webview.reload()\n  }\n  webContents.reloadIgnoringCache = function() {\n    webview.reloadFromOrigin()\n  }\n  webContents.canGoBack = function() {\n    return !!webview.canGoBack()\n  }\n  webContents.canGoForward = function() {\n    return !!webview.canGoForward()\n  }\n  webContents.canGoToOffset = function(offset) {\n    return !!webview.backForwardList().itemAtIndex(offset)\n  }\n  webContents.clearHistory = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.goBack = function() {\n    webview.goBack()\n  }\n  webContents.goForward = function() {\n    webview.goForward()\n  }\n  webContents.goToIndex = function(index) {\n    var backForwardList = webview.backForwardList()\n    var backList = backForwardList.backList()\n    var backListLength = backList.count()\n    if (backListLength > index) {\n      webview.loadRequest(NSURLRequest.requestWithURL(backList[index]))\n      return\n    }\n    var forwardList = backForwardList.forwardList()\n    if (forwardList.count() > index - backListLength) {\n      webview.loadRequest(\n        NSURLRequest.requestWithURL(forwardList[index - backListLength])\n      )\n      return\n    }\n    throw new Error('Cannot go to index ' + index)\n  }\n  webContents.goToOffset = function(offset) {\n    if (!webContents.canGoToOffset(offset)) {\n      throw new Error('Cannot go to offset ' + offset)\n    }\n    webview.loadRequest(\n      NSURLRequest.requestWithURL(webview.backForwardList().itemAtIndex(offset))\n    )\n  }\n  webContents.isCrashed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setUserAgent = function(/* userAgent */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.getUserAgent = function() {\n    const userAgent = webview.customUserAgent()\n    return userAgent ? String(userAgent) : undefined\n  }\n  webContents.insertCSS = function(css) {\n    var source =\n      \"var style = document.createElement('style'); style.innerHTML = \" +\n      css.replace(/\"/, '\\\\\"') +\n      '; document.head.appendChild(style);'\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.insertJS = function(source) {\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.executeJavaScript = executeJavaScript(webview, browserWindow)\n  webContents.setIgnoreMenuShortcuts = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setAudioMuted = function(/* muted */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.isAudioMuted = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setZoomFactor = function(factor) {\n    webview.setMagnification_centeredAtPoint(factor, CGPointMake(0, 0))\n  }\n  webContents.getZoomFactor = function(callback) {\n    callback(Number(webview.magnification()))\n  }\n  webContents.setZoomLevel = function(level) {\n    // eslint-disable-next-line no-restricted-properties\n    webContents.setZoomFactor(Math.pow(1.2, level))\n  }\n  webContents.getZoomLevel = function(callback) {\n    // eslint-disable-next-line no-restricted-properties\n    callback(Math.log(Number(webview.magnification())) / Math.log(1.2))\n  }\n  webContents.setVisualZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setLayoutZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  // TODO:\n  // webContents.undo = function() {\n  //   webview.undoManager().undo()\n  // }\n  // webContents.redo = function() {\n  //   webview.undoManager().redo()\n  // }\n  // webContents.cut = webview.cut\n  // webContents.copy = webview.copy\n  // webContents.paste = webview.paste\n  // webContents.pasteAndMatchStyle = webview.pasteAsRichText\n  // webContents.delete = webview.delete\n  // webContents.replace = webview.replaceSelectionWithText\n\n  webContents.send = function() {\n    const script =\n      'window.postMessage({' +\n      'isSketchMessage: true,' +\n      \"origin: '\" +\n      String(__command.identifier()) +\n      \"',\" +\n      'args: ' +\n      JSON.stringify([].slice.call(arguments)) +\n      '}, \"*\")'\n    webview.evaluateJavaScript_completionHandler(script, null)\n  }\n\n  webContents.getNativeWebview = function() {\n    return webview\n  }\n\n  browserWindow.webContents = webContents\n}\n","import initState, { context, Menus, IdentifierPrefix, SidePanelIdentifier } from './state'\nimport { Browser, BrowserManage } from './webview/index'\nimport { createImageView, addButton, createBoxSeparator, observerWindowResizeNotification, removeObserverWindowResizeNotification, setSettingForKey, removeSettingForKey } from './utils'\n\n/**\n * insertSidePanel \n * @param {*} toolbar\n * @param {*} identifier\n * @param {*} isInsert  \n */\nconst insertSidePanel = (toolbar, identifier, isInsert = false) => {\n  const contentView = context.document.documentWindow().contentView()\n  const stageView = contentView.subviews().objectAtIndex(0)\n\n  const views = stageView.subviews()\n  const existId = isInsert || views.find(d => ''.concat(d.identifier()) === identifier)\n\n  const finalViews = []\n  let pushedWebView = false\n\n  for (let i = 0; i < views.count(); i++) {\n    const view = views[i]\n    if (existId) {\n      if (''.concat(view.identifier()) !== identifier) finalViews.push(view)\n    } else {\n      finalViews.push(view)\n      if (!pushedWebView && ''.concat(view.identifier()) === 'view_canvas') {\n        finalViews.push(toolbar)\n        pushedWebView = true\n      }\n    }\n  }\n\n  if (pushedWebView) {\n    setSettingForKey(SidePanelIdentifier, 'true')\n  } else {\n    removeSettingForKey(SidePanelIdentifier)\n  }\n\n\n  stageView.subviews = finalViews\n  stageView.adjustSubviews()\n}\n\n\nexport const onToggleSidePanel = context => {\n  console.error('  plugins')\n  // register context\n  initState(context)\n\n  const threadDictionary = NSThread.mainThread().threadDictionary()\n  if (threadDictionary[SidePanelIdentifier]) {\n    insertSidePanel(threadDictionary[SidePanelIdentifier], SidePanelIdentifier, true)\n    onShutdown()\n    return\n  }\n\n  // Long-running script\n  COScript.currentCOScript().setShouldKeepAround(true)\n\n  observerWindowResizeNotification(() => {\n    const curWebView = BrowserManage.getCurrent()\n    if (curWebView) {\n      curWebView.updatePosition()\n    }\n  })\n\n  const toolbar = NSStackView.alloc().initWithFrame(NSMakeRect(0, 0, 40, 400))\n  threadDictionary[SidePanelIdentifier] = toolbar\n  toolbar.identifier = SidePanelIdentifier\n  toolbar.setSpacing(8)\n  toolbar.setFlipped(true)\n  toolbar.setBackgroundColor(NSColor.windowBackgroundColor())\n\n  toolbar.orientation = 1\n\n\n  toolbar.addView_inGravity(createImageView(NSMakeRect(0, 0, 40, 22), 'transparent', NSMakeSize(40, 22)), 1)\n  const Logo = createImageView(NSMakeRect(0, 0, 40, 30), 'logo', NSMakeSize(40, 28))\n  toolbar.addSubview(Logo)\n\n  Menus.map((item, index) => {\n    const {\n      rect = NSMakeRect(0, 0, 40, 40),\n      size = NSMakeSize(24, 24),\n      icon,\n      activeIcon,\n      tooltip,\n      identifier,\n      wkIdentifier,\n      type = 2,\n      inGravityType = 1,\n      url,\n    } = item\n\n    const Button = addButton({\n      rect,\n      size,\n      icon,\n      activeIcon,\n      tooltip,\n      identifier,\n      type,\n      callAction: sender => {\n        // log('sender', sender)\n        const threadDictionary = NSThread.mainThread().threadDictionary()\n        const menuBtnRegExp = new RegExp(`${IdentifierPrefix}-menu*`)\n        for (const k in threadDictionary) {\n          if (menuBtnRegExp.test(k) && k !== identifier) {\n            threadDictionary[k].setState(NSOffState)\n          }\n        }\n\n        const options = {\n          sender,\n          identifier: wkIdentifier,\n          frame: false,\n          show: false,\n          width: 320,\n          height: 480,\n          inGravityType,\n          url,\n        }\n\n        const { browserWindow } = new Browser(options)\n\n        const webView = browserWindow.webContents\n\n        webView.on('did-start-loading', () => {\n          // console.error('did-start-loading')\n        })\n\n        webView.on('did-finish-load', () => {\n          // console.error('did-finish-load')\n        })\n\n        webView.on('openView', options => {\n          // console.error('openViewopenView')\n        })\n      }\n    })\n\n    threadDictionary[identifier] = Button\n\n    toolbar.addView_inGravity(createBoxSeparator(), inGravityType)\n    toolbar.addView_inGravity(Button, inGravityType)\n\n    if (icon === 'fill') toolbar.addView_inGravity(createBoxSeparator(), inGravityType)\n    if (index === Menus.length - 1) toolbar.addView_inGravity(createImageView(NSMakeRect(0, 0, 40, 8), 'transparent'), 3)\n  })\n\n  insertSidePanel(toolbar, SidePanelIdentifier)\n}\n\n\nexport const onOpenDocument = () => {}\n\nexport const onCloseDocument = context => {\n  initState(context)\n  onShutdown()\n}\n\n// handler cleanly Long-running script\nexport function onShutdown () {\n  // console.error(' my-plugins onShutdown')\n  const threadDictionary = NSThread.mainThread().threadDictionary()\n  BrowserManage.empty()\n  const prefixRegExp = new RegExp(`${IdentifierPrefix}*`)\n  const webViewPrefixRegExp = new RegExp(`${IdentifierPrefix}-webview*`)\n\n  // clear MSClass\n  for (const key in threadDictionary) {\n    if (prefixRegExp.test(key)) {\n      if (webViewPrefixRegExp.test(key)) {\n        threadDictionary[key].close()\n      }\n      threadDictionary.removeObjectForKey(key)\n    }\n  }\n\n  // clear WindowResizeNotification\n  removeObserverWindowResizeNotification()\n\n  COScript.currentCOScript().setShouldKeepAround(false)\n}\n","export let context\nexport let document\nexport let version\nexport let sketchVersion\nexport let pluginFolderPath\nexport let resourcesPath\nexport let documentObjectID\nexport let IdentifierPrefix\nexport let SidePanelIdentifier\nexport let WINDOW_MOVE_INSTANCE\nexport let WINDOW_MOVE_SELECTOR\nexport let Menus\n\nfunction updateIdentifier (objectID) {\n  IdentifierPrefix = objectID ? `sketch-plugin-boilerplate-${objectID}` : 'sketch-plugin-boilerplate'\n  SidePanelIdentifier = `${IdentifierPrefix}-side-panel`\n  WINDOW_MOVE_INSTANCE = `window-move-instance-${objectID}`\n  WINDOW_MOVE_SELECTOR = `window-move-selector-${objectID}`\n  Menus = [\n    {\n      rect: NSMakeRect(0, 0, 40, 40),\n      size: NSMakeSize(24, 24),\n      icon: 'artboard',\n      activeIcon: 'artboard-active',\n      tooltip: '',\n      identifier: `${IdentifierPrefix}-menu.artboard`,\n      wkIdentifier: `${IdentifierPrefix}-webview.artboard`,\n      type: 2,\n      inGravityType: 1,\n      url: 'https://aotu.io',\n    },\n    {\n      rect: NSMakeRect(0, 0, 40, 40),\n      size: NSMakeSize(24, 24),\n      icon: 'icon',\n      activeIcon: 'icon-active',\n      tooltip: '',\n      identifier: `${IdentifierPrefix}-menu.icon`,\n      wkIdentifier: `${IdentifierPrefix}-webview.icon`,\n      type: 2,\n      inGravityType: 1,\n      url: 'https://docs.pfan123.com/',\n    },\n    {\n      rect: NSMakeRect(0, 0, 40, 40),\n      size: NSMakeSize(24, 24),\n      icon: 'component',\n      activeIcon: 'component-active',\n      tooltip: '',\n      identifier: `${IdentifierPrefix}-menu.component`,\n      wkIdentifier: `${IdentifierPrefix}-webview.component`,\n      type: 2,\n      inGravityType: 1,\n      url: 'https://m.baidu.com/',\n    },\n    {\n      rect: NSMakeRect(0, 0, 40, 40),\n      size: NSMakeSize(24, 24),\n      icon: 'palette',\n      activeIcon: 'palette-active',\n      tooltip: '',\n      identifier: `${IdentifierPrefix}-menu.palette`,\n      wkIdentifier: `${IdentifierPrefix}-webview.palette`,\n      type: 2,\n      inGravityType: 1,\n      url: 'https://aotu.io/',\n    },\n    {\n      rect: NSMakeRect(0, 0, 40, 40),\n      size: NSMakeSize(24, 24),\n      icon: 'fill',\n      activeIcon: 'fill-active',\n      tooltip: '',\n      identifier: `${IdentifierPrefix}-menu.fill`,\n      wkIdentifier: `${IdentifierPrefix}-webview.fill`,\n      type: 2,\n      inGravityType: 1,\n      url: 'https://aotu.io/',\n    },\n    {\n      rect: NSMakeRect(0, 0, 40, 40),\n      size: NSMakeSize(24, 24),\n      icon: 'help',\n      activeIcon: 'help-active',\n      tooltip: '',\n      identifier: `${IdentifierPrefix}-menu.help`,\n      wkIdentifier: `${IdentifierPrefix}-webview.help`,\n      type: 2,\n      inGravityType: 3,\n      url: 'https://aotu.io/',\n    },\n    {\n      rect: NSMakeRect(0, 0, 40, 40),\n      size: NSMakeSize(24, 24),\n      icon: 'setting',\n      activeIcon: 'setting-active',\n      tooltip: '',\n      identifier: `${IdentifierPrefix}-menu.setting`,\n      wkIdentifier: `${IdentifierPrefix}-webview.setting`,\n      type: 2,\n      inGravityType: 3,\n      url: 'https://aotu.io/',\n    }\n  ]\n}\n\nfunction getPluginFolderPath (context) {\n  // Get absolute folder path of plugin\n  const split = context.scriptPath.split('/')\n  split.splice(-3, 3)\n  return split.join('/')\n}\n\nexport default function (ctx) {\n  context = ctx\n  document = context.document || context.actionContext.document || MSDocument.currentDocument()\n  documentObjectID = document.documentData().objectID()\n  updateIdentifier(documentObjectID)\n  // eslint-disable-next-line no-new-wrappers\n  version = new String(context.plugin.version()).toString()\n  // eslint-disable-next-line no-new-wrappers\n  sketchVersion = new String(context.api().version).toString()\n  pluginFolderPath = getPluginFolderPath(context)\n  resourcesPath = `${pluginFolderPath}/Contents/Resources`\n}\n","import { context } from '../state'\n\n/**\n * getImageURL  icon \n * @param {*} name\n */\nexport const getImageURL = name => {\n  const isRetinaDisplay = NSScreen.mainScreen().backingScaleFactor() > 1\n  const suffix = isRetinaDisplay ? '@2x' : ''\n  const pluginSketch = context.plugin.url()\n  const imageURL = pluginSketch\n    .URLByAppendingPathComponent('Contents')\n    .URLByAppendingPathComponent('Resources')\n    .URLByAppendingPathComponent('icons')\n    .URLByAppendingPathComponent(`${name + suffix}.png`)\n  return imageURL\n}\n\n/**\n * createImage  NSImage\n * @param {*} imageURL\n * @param {*} size\n */\nexport const createImage = (imageURL, size) => {\n  // NSImage.alloc().initWithSize([width, height])\n  const Image = NSImage.alloc().initWithContentsOfURL(imageURL)\n  size && Image.setSize(size)\n  Image.setScalesWhenResized(true)\n  return Image\n}\n\n/**\n * createImageView  NSImageView\n * @param {*} rect\n * @param {*} icon\n * @param {*} size\n */\nexport const createImageView = (rect, icon, size) => {\n  const imageView = NSImageView.alloc().initWithFrame(rect)\n  const imageURL = getImageURL(icon)\n  const image = createImage(imageURL, size)\n  imageView.setImage(image)\n  imageView.setAutoresizingMask(5)\n  return imageView\n}\n\n/**\n * createImageView  NSBoxSeparator\n */\nexport const createBoxSeparator = () => {\n  // set to 0 in width and height\n  const separtorBox = NSBox.alloc().initWithFrame(NSZeroRect)\n  // Specifies that the box is a separator\n  separtorBox.setBoxType(2 || NSBoxSeparator)\n  separtorBox.setBorderColor(NSColor.colorWithHex('#F5F5F5'))\n  try {\n    separtorBox.setBorderColor(NSColor.colorWithSRGBRed_green_blue_alpha(1.0, 1.0, 1.0, 1.0))\n  } catch (error) {\n    console.error(error)\n  }\n\n  // separtorBox.setTransparent(true)\n  return separtorBox\n}\n\n/**\n * addButton  NSButton\n * @param {*} param { rect, size, icon, activeIcon, tooltip = '', type = 5, callAction }\n */\nexport const addButton = ({ rect, size, icon, activeIcon, tooltip = '', type = 5, callAction }) => {\n  const button = rect ? NSButton.alloc().initWithFrame(rect) : NSButton.alloc().init()\n  const imageURL = getImageURL(icon)\n  const image = createImage(imageURL, size)\n  button.setImage(image)\n\n  if (activeIcon) {\n    const activeImageURL = getImageURL(activeIcon)\n    const activeImage = createImage(activeImageURL, size)\n    button.setAlternateImage(activeImage)\n  } else {\n    button.setAlternateImage(image)\n  }\n  button.setBordered(false)\n  button.sizeToFit()\n  button.setToolTip(tooltip)\n  button.setButtonType(type || NSMomentaryChangeButton)\n  button.setCOSJSTargetFunction(callAction)\n  button.setAction('callAction:')\n  button.removeBadge = () => {\n    button.setImage(image)\n    button.hasBadge = false\n  }\n  button.icon = icon\n  return button\n}\n\n/**\n *  bounds\n * @param {*} x\n * @param {*} y\n * @param {*} width\n * @param {*} height\n */\nexport const createBounds = (x = 0, y = 0, width = 0, height = 0) => NSMakeRect(\n  x,\n  y,\n  width,\n  height\n)\n\n/**\n * createView  NSPanel\n * @param {*} frame  options\n */\nexport const createPanel = (options = {\n  width: 800,\n  height: 600,\n  minWidth: 0,\n  minHeight: 0,\n  x: 0,\n  y: 0,\n  title: 'panel',\n  identifier: 'sketch-panel',\n  vibrancy: true,\n}) => {\n  COScript.currentCOScript().setShouldKeepAround(true)\n\n  const threadDictionary = NSThread.mainThread().threadDictionary()\n  const mainScreenRect = NSScreen.screens()\n    .firstObject()\n    .frame()\n\n  const Bounds = NSMakeRect(\n    options.x ? options.x : Math.round((NSWidth(mainScreenRect) - options.width) / 2),\n    options.y ? NSHeight(mainScreenRect) - options.y : Math.round((NSHeight(mainScreenRect) - options.height) / 2),\n    options.width,\n    options.height\n  )\n  const panel = NSPanel.alloc().init()\n  panel.setFrame_display(Bounds, true)\n  panel.setOpaque(0)\n  threadDictionary[options.identifier] = panel\n\n  // NSWindowStyleMaskDocModalWindow \n  panel.setStyleMask(NSWindowStyleMaskFullSizeContentView | NSBorderlessWindowMask | NSResizableWindowMask | NSTexturedBackgroundWindowMask | NSTitledWindowMask | NSClosableWindowMask | NSFullSizeContentViewWindowMask | NSWindowStyleMaskResizable)\n  panel.setBackgroundColor(NSColor.whiteColor() || NSColor.windowBackgroundColor())\n\n  panel.title = options.title\n  panel.movableByWindowBackground = true\n  panel.titlebarAppearsTransparent = true\n  panel.titleVisibility = NSWindowTitleHidden\n\n  panel.center()\n  panel.makeKeyAndOrderFront(null)\n  panel.setLevel(NSFloatingWindowLevel)\n  panel.minSize = NSMakeSize(options.minWidth, options.minHeight)\n\n  panel.standardWindowButton(NSWindowZoomButton).setHidden(true)\n  panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true)\n  panel.standardWindowButton(NSWindowCloseButton).setHidden(true)\n\n  // Some third-party macOS utilities check the zoom button's enabled state to\n  // determine whether to show custom UI on hover, so we disable it here to\n  // prevent them from doing so in a frameless app window.\n  panel.standardWindowButton(NSWindowZoomButton).setEnabled(false)\n\n  // The fullscreen button should always be hidden for frameless window.\n  if (panel.standardWindowButton(NSWindowFullScreenButton)) {\n    panel.standardWindowButton(NSWindowFullScreenButton).setHidden(true)\n  }\n\n  panel.showsToolbarButton = false\n  panel.movableByWindowBackground = true\n\n  if (options.vibrancy) {\n    // Create the blurred background\n    const effectView = NSVisualEffectView.alloc().initWithFrame(NSMakeRect(0, 0, options.width, options.height))\n    effectView.setMaterial(NSVisualEffectMaterialPopover)\n    effectView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n    effectView.setAppearance(NSAppearance.appearanceNamed(NSAppearanceNameVibrantLight))\n    effectView.setBlendingMode(NSVisualEffectBlendingModeBehindWindow)\n\n    // Add it to the panel\n    panel.contentView().addSubview(effectView)\n  }\n\n  const closeButton = panel.standardWindowButton(NSWindowCloseButton)\n  closeButton.setCOSJSTargetFunction(sender => {\n    log(sender)\n\n    panel.close()\n\n    // Remove the reference to the panel\n    threadDictionary.removeObjectForKey(options.identifier)\n\n    // Stop this Long-running script\n    COScript.currentCOScript().setShouldKeepAround(false)\n  })\n  return panel\n}\n\n/**\n * createView  NSView\n * @param {*} frame  NSMakeRect(0, 0, 40, 40)\n */\nexport const createView = frame => {\n  const view = NSView.alloc().initWithFrame(frame)\n  view.setFlipped(1)\n  return view\n}\n\n/**\n * createBox  NSBox\n * @param {*} frame  NSMakeRect(0, 0, 40, 40)\n */\nexport const createBox = frame => {\n  const box = NSBox.alloc().initWithFrame(frame)\n  box.setTitle('')\n  return box\n}\n\n\n/**\n * createBox  createTextField\n * @param {*} string\n * @param {*} frame NSMakeRect(0, 0, 40, 40)\n */\nexport const createTextField = (string, frame) => {\n  const field = NSTextField.alloc().initWithFrame(frame)\n\n  field.setStringValue(string)\n  field.setFont(NSFont.systemFontOfSize(12))\n  field.setTextColor(\n    NSColor.colorWithCalibratedRed_green_blue_alpha(0, 0, 0, 0.7)\n  )\n  field.setBezeled(0)\n  field.setBackgroundColor(NSColor.windowBackgroundColor())\n  field.setEditable(0)\n\n  return field\n}\n\n","/**\n * File \n * NSString.stringWithFormat('%@', content)\n */\n\nexport const File = {\n  fileManager: NSFileManager.defaultManager(),\n\n  _stringify (jsonData, opt) {\n    opt = opt ? 1 : 0\n    const nsJson = NSJSONSerialization.dataWithJSONObject_options_error_(jsonData, opt, nil)\n    return NSString.alloc().initWithData_encoding(nsJson, 4)\n  },\n\n  writeFile (content, path) {\n    content = NSString.stringWithFormat('%@', content)\n    path = NSString.stringWithFormat('%@', path)\n    return content.writeToFile_atomically_encoding_error_(path, !0, 4, nil)\n  },\n\n  copyFile (path, dist) {\n    return this.fileManager.fileExistsAtPath(path) ? this.fileManager.copyItemAtPath_toPath_error(path, dist, nil) : nil\n  },\n\n  mkDir (path) {\n    return !this.fileManager.fileExistsAtPath(path) && this.fileManager.createDirectoryAtPath_withIntermediateDirectories_attributes_error_(path, !0, nil, nil)\n  },\n\n  readJSON (path, opt) {\n    const src = NSData.dataWithContentsOfFile(path)\n    const options = !0 === opt ? 1 : 0\n    return NSJSONSerialization.JSONObjectWithData_options_error(src, options, nil)\n  },\n\n  size (patch) {\n    let size = 0\n    try {\n      size = this.fileManager.attributesOfItemAtPath_error(patch, nil).NSFileSize\n    } catch (e) {\n      size = 0\n    }\n    return size\n  },\n\n  renameFile (from, to) {\n    this.fileManager.fileExistsAtPath(from) && this.fileManager.moveItemAtPath_toPath_error(from, to, null)\n  },\n\n  exist (path) {\n    return !!this.fileManager.fileExistsAtPath(path)\n  },\n\n  readDir (path) {\n    return !!this.fileManager.fileExistsAtPath(path) && this.fileManager.contentsOfDirectoryAtPath_error_(path, nil)\n  },\n\n  removeDir (path) {\n    this.fileManager.removeItemAtPath_error(path, null)\n  },\n\n  getTempDirPath () {\n    const URL = this.fileManager.URLsForDirectory_inDomains(13, 1).lastObject()\n    const hash = Date.now() / 1e3\n    const nsString = NSString.stringWithFormat('%@', hash)\n    return URL.URLByAppendingPathComponent(nsString).path()\n  },\n\n  mkTempDir (path) {\n    const URL = this.getTempDirPath(path)\n    return this.mkDir(URL) || URL\n  },\n\n  /**\n   * @param {String} image\n   * @param {MSImageData} image\n   */\n  saveImage (path, image) {\n    const tiffData = image.TIFFRepresentation()\n    const p = NSBitmapImageRep.imageRepWithData(tiffData)\n    const data = p.representationUsingType_properties(NSPNGFileType, null)\n    data.writeToFile_atomically(path, !0)\n  },\n\n  jsonFilePaths (path) {\n    let filename\n    const ds = this.fileManager.enumeratorAtPath(path)\n    const paths = []\n    // eslint-disable-next-line no-cond-assign\n    while (filename = ds.nextObject()) {\n      if (filename.pathExtension() == 'json') {\n        paths.push(filename)\n      }\n    }\n\n    return paths\n  }\n}\n","export * from './element'\nexport * from './selector'\nexport * from './system'\nexport * from './file'\n","import { context } from '../state'\nimport sketch from 'sketch'\n\n\n/**\n * getSketchSelected  document page selection\n */\nexport const getSketchSelected = () => {\n  const Document = sketch.Document\n  const document = Document.getSelectedDocument() //  document\n  const page = document.selectedPage //  page\n  const artboard = sketch.Artboard.fromNative(page._object.currentArtboard())\n  const selection = document.selectedLayers // \n\n  return {\n    document,\n    page,\n    artboard,\n    selection,\n  }\n}\n\n\n/**\n * getSelected  documentpageartboardselection\n */\nexport const getSelected = () => {\n  const document = context.document //  sketch  document\n  const plugin = context.plugin\n  const command = context.command\n  const page = document.currentPage() //  page\n  const artboards = page.artboards() // \n  const selectedArtboard = page.currentArtboard() // \n  const selection = context.selection // \n\n  return {\n    document,\n    plugin,\n    command,\n    page,\n    artboards,\n    selectedArtboard,\n    selection,\n  }\n}\n\n\n/**\n * \n * @param {*} context\n */\nexport const getScriptExecPath = context => context.scriptPath\n\n/**\n * document  document objectID\n */\nexport const getDocumentID = () => context.document.documentData().objectID()\n\n/**\n * getDocumentPath  document \n */\nexport const getDocumentPath = () => {\n  const Document = context.document\n  return Document.fileURL() ? Document.fileURL().path() : nil\n}\n\n/**\n * getDocumentName  document name\n */\nexport const getDocumentName = () => (getDocumentPath(context) ? getDocumentPath(context).lastPathComponent() : nil)\n\n\n/**\n * dumpLayer json\n * @param {*} sketchObject   context.document.currentPage()\n */\nexport const dumpLayer = sketchObject => {\n  // return NSDictionary\n  const jsonData = sketchObject.treeAsDictionary()\n  const nsData = NSJSONSerialization.dataWithJSONObject_options_error_(jsonData, 0, nil)\n  return NSString.alloc().initWithData_encoding_(nsData, 4)\n}\n\n/**\n * dumpSymbol json\n * @param {*} symbolInstance // context.selection[0]\n */\nexport const dumpSymbol = symbolInstance => {\n  // return symbolInstance\n  const immutableInstance = symbolInstance.immutableModelObject()\n  return MSJSONDataArchiver.archiveStringWithRootObject_error(immutableInstance, nil)\n}\n","import MochaJSDelegate from 'mocha-js-delegate'\nimport { context, WINDOW_MOVE_INSTANCE, WINDOW_MOVE_SELECTOR } from '../state'\n\n\n/**\n * openUrlInBrowser \n * @param {string} url\n */\nexport const penUrlInBrowser = url => {\n  NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(url))\n}\n\n/**\n * getNewUUID  ID\n */\nexport const getNewUUID = () => NSUUID.UUID().UUIDString()\n\n/**\n * getThreadDictForKey  mainThread \n * @param {string} key\n */\nexport const getThreadDictForKey = key => NSThread.mainThread().threadDictionary()[key]\n\n/**\n * setThreadDictForKey  mainThread \n * @param {string} key\n * @param {string} value\n */\nexport const setThreadDictForKey = (key, value) => NSThread.mainThread().threadDictionary()[key] = value\n\n/**\n * removeThreadDictForKey  mainThread \n * @param { string } key\n */\nexport const removeThreadDictForKey = key => {\n  if (NSThread.mainThread().threadDictionary()[key]) NSThread.mainThread().threadDictionary().removeObjectForKey(key)\n}\n\n/**\n * getSettingForKey  NSUserDefaults \n * @param { string } key\n */\nexport const getSettingForKey = key => NSUserDefaults.standardUserDefaults().objectForKey(key)\n\n/**\n * setSettingForKey  NSUserDefaults \n * @param {string} key\n * @param {string} value\n */\nexport const setSettingForKey = (key, value) => NSUserDefaults.standardUserDefaults().setObject_forKey(value, key)\n\n/**\n * removeSettingForKey  NSUserDefaults \n * @param { string } key\n */\nexport const removeSettingForKey = key => {\n  setSettingForKey(key, nil)\n}\n\n/**\n * showPluginsPane  plugin window\n */\nexport const showPluginsPane = () => {\n  const identifier = MSPluginsPreferencePane.identifier()\n  const preferencesController = MSPreferencesController.sharedController()\n  preferencesController.switchToPaneWithIdentifier(identifier)\n  preferencesController.currentPreferencePane().tableView().reloadData()\n}\n\n/**\n * showLibrariesPane  libraries window\n */\nexport const showLibrariesPane = () => {\n  const identifier = MSAssetLibrariesPreferencePane.identifier()\n  const preferencesController = MSPreferencesController.sharedController()\n  preferencesController.switchToPaneWithIdentifier(identifier)\n  preferencesController.currentPreferencePane().tableView().reloadData()\n}\n\n/**\n * getSystemVersion \n */\nexport const getSystemVersion = () => {\n  try {\n    const systemVersion = NSProcessInfo.processInfo().operatingSystemVersionString().match(/\\d*\\.\\d*(\\.\\d*)?/)\n    if (systemVersion && systemVersion[0]) {\n      const versions = systemVersion[0]\n      return versions.split('.').length === 2 ? ''.concat(versions, '.0') : versions\n    }\n    return '0.0.0'\n  } catch (e) {\n    return '0.0.0'\n  }\n}\n\n/**\n * getPluginVersion \n */\nexport const getPluginVersion = () => context.plugin.version()\n\n/**\n * reloadPlugins \n */\nexport const reloadPlugins = () => {\n  AppController.sharedInstance().pluginManager().reloadPlugins()\n}\n\n/**\n * getFileContentFromModal \n * @param {Array<string>} fileTypes \n */\nexport const getFileContentFromModal = (fileTypes = []) => {\n  const openPanel = NSOpenPanel.openPanel()\n\n  openPanel.setTitle('Choose a JSON File')\n  openPanel.canCreateDirectories = false\n  openPanel.canChooseFiles = true\n  openPanel.allowedFileTypes = fileTypes\n\n  const openPanelButtonPressed = openPanel.runModal()\n  if (openPanelButtonPressed === NSModalResponseOK) {\n    const filePath = openPanel.URL().path()\n    return NSString.stringWithContentsOfFile_encoding_error(filePath, NSUTF8StringEncoding, nil)\n  }\n\n  return ''\n}\n\n/**\n * getSavePathFromModal \n * @param {String} fileName \n * @param {Array<string>} fileTypes \n */\nexport const getSavePathFromModal = (fileName, fileTypes = ['json']) => {\n  if (!fileName) return\n  const savePanel = NSSavePanel.savePanel()\n  savePanel.canCreateDirectories = true\n  savePanel.nameFieldStringValue = fileName\n  savePanel.allowedFileTypes = fileTypes\n\n  const savePanelActionStatus = savePanel.runModal()\n  if (savePanelActionStatus === NSModalResponseOK) {\n    const filePath = savePanel.URL().path()\n    return {\n      filePath,\n      fileName: savePanel.nameFieldStringValue(),\n    }\n  }\n\n  return false\n}\n\n/**\n * observerWindowResizeNotification resize\n * @param {*} fn\n */\nexport const observerWindowResizeNotification = fn => {\n  // Keep script around, otherwise everything will be dumped once its run\n  // COScript.currentCOScript().setShouldKeepAround(true)\n\n  if (!getThreadDictForKey(WINDOW_MOVE_INSTANCE)) {\n    // Create a selector\n    const Selector = NSSelectorFromString('onWindowMove:')\n\n    const delegate = new MochaJSDelegate({\n      'onWindowMove:': notification => {\n        // const bounds = NSScreen.mainScreen().frame()\n        fn(notification)\n        // log(notification)\n        // NSNotificationCenter.defaultCenter().removeObserver_name_object(delegateInstance, NSWindowDidResizeNotification, nil)\n      }\n    })\n\n    // Don't forget to create a class instance of the delegate\n    const delegateInstance = delegate.getClassInstance()\n\n    NSNotificationCenter\n      .defaultCenter()\n      .addObserver_selector_name_object(delegateInstance, Selector, NSWindowDidResizeNotification, nil)\n\n    setThreadDictForKey(WINDOW_MOVE_INSTANCE, delegateInstance)\n    setThreadDictForKey(WINDOW_MOVE_SELECTOR, Selector)\n  }\n}\n\n/**\n * removeObserverWindowResizeNotification resize\n * @param {*} fn\n */\nexport const removeObserverWindowResizeNotification = () => {\n  const delegateInstance = getThreadDictForKey(WINDOW_MOVE_INSTANCE)\n  if (delegateInstance) {\n    NSNotificationCenter.defaultCenter().removeObserver_name_object(delegateInstance, NSWindowDidResizeNotification, nil)\n    removeThreadDictForKey(WINDOW_MOVE_INSTANCE)\n    removeThreadDictForKey(WINDOW_MOVE_SELECTOR)\n  }\n}\n","import { context, document } from '../state'\nimport BrowserWindow from 'sketch-module-web-view'\n\nexport const BrowserManage = {\n  list: [],\n\n  add (browser) {\n    this.list.push(browser)\n  },\n\n  get (identifier) {\n    return this.list.find(d => d.identifier === identifier)\n  },\n\n  getCurrent () {\n    return this.list.find(d => d.browserWindow.isVisible())\n  },\n\n  empty () {\n    this.list = []\n  }\n}\n\nconst getAbsScreenOfTop = () => {\n  const contentView = document.documentWindow().contentView()\n  const width = contentView.frame().size.width\n  const height = contentView.frame().size.height\n  const x = contentView.frame().origin.x\n  const y = contentView.frame().origin.y\n  const rect = document.window().convertRectToScreen(NSMakeRect(x, y, width, height))\n  return rect\n}\n\nconst getAbsWindowOfView = button => {\n  const bounds = button.bounds()\n  const width = bounds.size.width\n  const height = bounds.size.height\n  const x = bounds.origin.x\n  const y = bounds.origin.y\n  return button.convertRect_toView(NSMakeRect(x, y, width, height), nil)\n}\n\nexport class Browser {\n  constructor (options) {\n    this.options = Object.assign({\n      width: 290,\n      height: 550,\n      minimizable: false,\n      resizable: false,\n      transparent: false,\n      closable: false,\n      center: false,\n      alwaysOnTop: true,\n      titleBarStyle: 'hiddenInset',\n      frame: false,\n      show: false\n    }, options)\n\n    this.identifier = options.identifier\n\n    BrowserManage.list.forEach(d => {\n      if (d.identifier != this.identifier) {\n        if (d.browserWindow.isVisible()) {\n          d.hide()\n        }\n      }\n    })\n\n    const existBrowser = BrowserManage.get(options.identifier)\n    if (existBrowser) {\n      if (existBrowser.browserWindow.isVisible()) {\n        existBrowser.hide()\n      } else {\n        existBrowser.show()\n      }\n      return existBrowser\n    }\n\n    this.browserWindow = new BrowserWindow(options)\n    options.url && this.browserWindow.loadURL(options.url)\n    this.browserWindow._panel.setStyleMask(NSWindowStyleMaskDocModalWindow)\n    BrowserManage.add(this)\n    this.show()\n  }\n\n  show () {\n    this.updatePosition()\n    const documentWindow = context.document.documentWindow()\n    documentWindow.addChildWindow_ordered(this.browserWindow._panel, true)\n\n    this.browserWindow.show()\n  }\n\n  hide () {\n    this.browserWindow.hide()\n    if (this.browserWindow.webContents) {\n      this.browserWindow.webContents.removeAllListeners()\n    }\n  }\n\n  updatePosition () {\n    const { sender, inGravityType } = this.options\n    const [ width, height ] = this.browserWindow.getSize()\n    const winRect = getAbsScreenOfTop()\n    const senderRect = getAbsWindowOfView(sender)\n    const x = winRect.origin.x + senderRect.origin.x - sender.frame().origin.x - width - 1\n\n    if (inGravityType === 1) {\n      const y = winRect.origin.y + senderRect.origin.y + 24 - height + 8\n      this.browserWindow._panel.setFrame_display(NSMakeRect(x, y, width, height), true)\n    } else if (inGravityType === 3) {\n      const y = winRect.origin.y\n      this.browserWindow._panel.setFrame_display(NSMakeRect(x, y, width, height), true)\n    }\n  }\n}\n","module.exports = require(\"events\");","module.exports = require(\"sketch\");"],"sourceRoot":""}